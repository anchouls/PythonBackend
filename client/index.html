<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<p>Введите название картинки и добавте точки</p>
<div>
    <input id="name" type="text" placeholder="Название"/>
</div>


<dialog>
    <p>Введите координаты точки:</p>
    <input type="number" step="0.01" placeholder="x" id="x"/>
    <input type="number" step="0.01" placeholder="y" id="y"/>
    <button id="close">Добавить</button>
</dialog>
<button id="show">Добавить точку</button>

<div>
    <button id="draw"> Нарисовать</button>
</div>

<img id="img" src="" height="600" width="600"/>


<script type=text/javascript>
    let dialog = document.querySelector('dialog');
    document.querySelector('#show').onclick = function () {
        dialog.show();
    };
    document.querySelector('#close').onclick = function () {
        add();
        dialog.close();
    };

    async function send(postData) {
        try {
            const response = await fetch('http://127.0.0.1:8000/items', {
                method: 'POST',
                body: JSON.stringify(postData),
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const json = await response.json();
            console.log('Успех:', JSON.stringify(json));
        } catch (error) {
            console.error('Ошибка:', error);
        }
    }

    function add() {
        let x = document.querySelector('#x').value;
        let y = document.querySelector('#y').value;
        let name  = document.querySelector('#name').value;
        let postData = {
            name: name,
            x: parseFloat(x),
            y: parseFloat(y)
        };
        send(postData);
    }

    document.querySelector('#draw').onclick = function () {
        draw();
    };

    function draw() {
        fetch('http://127.0.0.1:8000/draw/' + document.querySelector('#name').value)
            .then(response => response.blob())
            .then(imageBlob => {
                const imageObjectURL = URL.createObjectURL(imageBlob);
                console.log(imageObjectURL);
                document.querySelector('#img').src = imageObjectURL;

            });
    }
</script>


</body>
</html>